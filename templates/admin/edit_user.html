{% extends 'admin/base.html' %}
{% block title %} Dashboard {% endblock %}
{% block header %}
<script src="/static/js/asserts/vue.js"></script>
<script src="/static/js/asserts/vue-axios.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.2/timeago.min.js"></script>
<link rel="stylesheet" href="/static/css/pages/admin/edit_user.css">
{% endblock%}

<script>
    var domain = "{{ domain() }}";
</script>

{% macro card(title='base', haschart=true, chartname='base', data="0") %}
<div class="card">
    <div class="card-body">
        <div class="d-flex align-items-center">
            <div class="subheader">{{ title }}</div>
        </div>
        <div class="d-flex align-items-baseline">
            <div class="h1 mb-0 me-2">{{ data }}</div>
        </div>
    </div>
    {% if haschart %}
    <div id="chart-{{ chartname }}" class="chart-sm"></div>
    {% endif %}
</div>
{% endmacro %}

{% block content %}
<script>
    var element = document.getElementById("navbar_users");
    element.classList.add("active");
</script>

<div class="page-wrapper">
    <!-- Page title -->
    <div class="container-xl">
        <!-- Page title -->
        <div class="page-header d-print-none">
            <div class="row align-items-center">
                <div class="col">
                    <h2 class="page-title" style="margin-top: 0; margin-bottom: 20px; margin-left: 15px;">
                        Manage user
                    </h2>
                </div>
            </div>
        </div>
        {% if flash %}
        <div class='noti-banner noti-banner-warning'>
            <div class="container">
                <div class="noti-column">
                    <div class='noti-col noti-col-icon'></div>
                    <div class='noti-col noti-col-label'>
                        <div class='noti-bannertype'>
                            {% if status=='error' %}
                            Warning
                            {% elif status=='success' %}
                            Notice
                            {% endif %}
                        </div>
                        <div class='noti-bannertext'>
                            {% if status=='error' %}
                            Uh oh! Be careful!
                            {% elif status=='success' %}
                            Hey! Listen!
                            {% endif %}
                        </div>
                    </div>
                    <div class='noti-banner-text'>
                        {{ flash }}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <div class="page-body">
        <div class="container-xl d-flex flex-column">
            {% if access_denied['higher_group'] == True %}
            <div class="card bg-red" style="color: white;">
                <div class="card-body text-left">{{ access_denied['err_msg']}}</div>
            </div>
            {% else %}
            <div class="card">
                <div class="user-info-card">
                    <div class="avatar-part-info">
                        <div class="user-info-avatar">
                            <a href="/u/{{ user_data['id'] }}"><img
                                    src="https://a.{{ domain() }}/{{ user_data['id'] }}?t={{ current_time }}"
                                    class="user-avatar"></a>
                        </div>
                    </div>
                    <div class="data-part-info">
                        <div class="user-info-group"> <!-- avatar, name, perm_group, status other info -->
                            <div class="group-item" style="margin-left: 12px;"><a href="/u/{{ user_data['id'] }}">{{
                                    user_data['name'] }}</a></div>
                            <div class="group-divider"></div>
                            <div class="group-item"><span class="">perm_group</span></div>
                            <div class="group-divider"></div>
                            <div class="group-item">
                                {% if online_status == False %}
                                offline
                                {% elif online_status == True %}
                                online
                                {% else %}
                                error
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-divider"></div>
                        <div class="user-extra-info">
                            <div class="extra-item"><img src="/static/images/flags/{{ user_data['country']|upper }}.png"
                                    class="profile-flag"> {{ user_data['country'] }}</div>
                            <div class="extra-item">{{ user_data['email'] }}</div>
                            <div class="extra-item">Joined {{ user_data['creation_time'] }}</div>
                        </div>
                    </div>
                    <!-- <div class="user-divider"></div> -->
                </div>

                <div class="user-edit-card"> <!-- edit fields etc -->
                    <div class="actions-field">
                        <div class="main-actions">
                            <div class="input-fields-group">
                                <form action="{{ url_for('admin.update_userinfo', id=user_data['id']) }}" method="POST">
                                    <div class="input-container">
                                        <h3>Main Information</h3>
                                        <div class="input-title">Username</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control">
                                                    <input placeholder="username" class="input" type="text"
                                                        name="username" value="{{ user_data['name'] }}">
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-container">
                                        <div class="input-title">Safename (convert username spaces to underscore)</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control">
                                                    <input placeholder="safe_name" class="input" type="text"
                                                        name="safename" value="{{ user_data['safe_name'] }}">
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-container">
                                        <div class="input-title">AKA</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control d-flex">
                                                    <input placeholder="AKA" class="input" type="text"
                                                        name="username_aka" value="{{ user_data['username_aka'] }}">
                                                    <button class="ml-2 button is-danger is-small"
                                                        style="font-size: 15px; border-radius: 0.4em;" type="button"
                                                        onclick="clearAka()">Clear</button>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-container">
                                        <div class="input-title">Email</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control">
                                                    <input placeholder="email" class="input" type="email" name="email"
                                                        value="{{ user_data['email'] }}">
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-container">
                                        <div class="input-title">Country</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control">
                                                    <select class="input" name="country" id="country-select"></select>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="custom-button buttons mt-2">
                                            <button class="button is-primary" type="submit" onclick="example(event)">
                                                <span class="icon is-small"><i class="fas fa-check"></i></span>
                                                <span>Save</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>

                                <script>
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const countrySelect = document.getElementById('country-select');
                                        const userCountry = '{{ user_data["country"] }}'.toLowerCase();

                                        for (const [code, name] of Object.entries(window.flags)) {
                                            const option = document.createElement('option');
                                            option.value = code.toLowerCase();
                                            option.textContent = name;
                                            if (code.toLowerCase() === userCountry) {
                                                option.selected = true;
                                            }
                                            countrySelect.appendChild(option);
                                        }
                                    });

                                    function clearAka() {
                                        document.querySelector('input[name="username_aka"]').value = '';  // Set to empty string to clear, adjust as needed
                                    }
                                </script>
                            </div>
                            <div class="input-title">
                                <h2>(Dangerous Area)</h2>
                                Quick actions
                            </div>
                            <div class="quick-action-group">
                                {% if not user_data['id'] == 3 %}
                                {% if not access_denied.higher_group %}
                                <form action="{{ url_for('admin.wipe_socials', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="submit" class="">Clear Socials</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                <form action="{{ url_for('admin.clear_banner', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="submit" class="">Remove Banner</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                <form action="{{ url_for('admin.clear_background', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="submit" class="">Remove BG</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                <form action="{{ url_for('admin.clear_avatar', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="submit" class="">Remove PFP</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                <form action="{{ url_for('admin.clear_aboutme', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="submit" class="">Clear AboutMe</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                {% if user_data['private_mode'] == 1 %}
                                <form id="privateProfileForm"
                                    action="{{ url_for('admin.private_profile', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-good">
                                        <button type="submit" class="">Unprivate Profile</button>
                                    </span>
                                </form>
                                {% else %}
                                <form id="privateProfileForm"
                                    action="{{ url_for('admin.private_profile', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-good">
                                        <button type="submit" class="">Private Profile</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                {% if user_data['is_legit'] == 0 %}
                                <form id="legitVerifiyForm"
                                    action="{{ url_for('admin.verified_user', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-good">
                                        <button type="submit" class="">Verify Legit</button>
                                    </span>
                                </form>
                                {% else %}
                                <form id="legitVerifiyForm"
                                    action="{{ url_for('admin.verified_user', id=user_data['id']) }}" method="POST"
                                    onsubmit="example(event)">
                                    <span class="quick-action-item action-btn-good">
                                        <button type="submit" class="">Unverify Legit</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% endif %}
                                {% if not access_denied.higher_group and not user_data['id'] == 3 %}
                                <form id="GraphForm" action="{{ url_for('admin.clear_graphs', id=user_data['id']) }}"
                                    method="POST" onsubmit="exampleDGR(event)">
                                    <span class="quick-action-item action-btn-dngr">
                                        <button type="submit" class="">Clear Graphs</button>
                                    </span>
                                </form>
                                {% else %}
                                <span class="quick-action-item action-btn-dngr">
                                    <button type="button" id="">not happening</button>
                                </span>
                                {% endif %}
                                {% if not access_denied.higher_group %}
                                {% if user_data['priv'] == 2 %}
                                <form id="unrestrictForm"
                                    action="{{ url_for('admin.unrestrict_user', id=user_data['id']) }}" method="POST">
                                    <input type="hidden" name="reason" id="reasonUnrestrict">
                                    <span class="quick-action-item action-btn-safe">
                                        <button type="button" id="unrestrictButton">Unrestrict User</button>
                                    </span>
                                </form>
                                {% elif user_data['id'] == 3 %}
                                <span class="quick-action-item action-btn-dngr">
                                    <button type="button" id="">not happening</button>
                                </span>
                                {% else %}
                                <form id="restrictForm"
                                    action="{{ url_for('admin.restrict_user', id=user_data['id']) }}" method="POST">
                                    <input type="hidden" name="reason" id="reasonRestrict">
                                    <span class="quick-action-item action-btn-dngr">
                                        <button type="button" id="restrictButton">Restrict User</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% endif %}
                                {% if not access_denied.higher_group and not user_data['id'] == 3 %}
                                <form id="WipeForm" action="{{ url_for('admin.wipe_account', id=user_data['id']) }}"
                                    method="POST">
                                    <input type="hidden" name="reason" id="reasonWipe">
                                    <span class="quick-action-item action-btn-death">
                                        <button type="button" id="WipeButton">Wipe Account</button>
                                    </span>
                                </form>
                                {% endif %}
                                {% else %}
                                You can't manage the server owner...
                                {% endif %}
                                <!-- <span onclick="example()" class="quick-action-item action-btn-dngr">Example Button</span> -->
                                <!-- confirm pop up -->
                                <div id="notification" class="hidden notification-w">
                                    <div class="notification-content" id="confirmationDialog">
                                        <p>Please type Confirm clearing graphs for {{ user_data['name'] }}" to proceed:
                                        </p>
                                        <input class="input" type="text" id="confirmInput">
                                        <button class="button is-primary" id="confirmButton">Confirm</button>
                                        <button class="button cancel" id="cancelButton">Cancel</button>
                                    </div>
                                </div>
                                <!-- Restrict Confirmation Dialog -->
                                <div id="confirmationDialogRestrict" class="hidden notification-w">
                                    <div class="notification-content">
                                        <p>Please type "Confirm restriction for {{ user_data['name'] }}" to proceed:</p>
                                        <input type="text" id="confirmInputRestrict"
                                            placeholder="Type confirmation message" class="input mb-2">
                                        <input type="text" id="reasonInputRestrict" placeholder="Reason for restriction"
                                            class="input">
                                        <button id="confirmButtonRestrict" class="button is-primary">Confirm</button>
                                        <button id="cancelButtonRestrict" class="button cancel">Cancel</button>
                                    </div>
                                </div>
                                <!-- Unrestrict Confirmation Dialog -->
                                <div id="confirmationDialogUnrestrict" class="hidden notification-w">
                                    <div class="notification-content">
                                        <p>Please type "Confirm unrestriction for {{ user_data['name'] }}" to proceed:
                                        </p>
                                        <input type="text" id="confirmInputUnrestrict"
                                            placeholder="Type confirmation message" class="input mb-2">
                                        <input type="text" id="reasonInputUnrestrict"
                                            placeholder="Reason for unrestriction" class="input">
                                        <button id="confirmButtonUnrestrict" class="button is-primary">Confirm</button>
                                        <button id="cancelButtonUnrestrict" class="button cancel">Cancel</button>
                                    </div>
                                </div>
                                <!-- Wipe Confirmation Dialog -->
                                <div id="confirmationDialogWipe" class="hidden notification-w">
                                    <div class="notification-content">
                                        <p>Please type "Confirm wipe for {{ user_data['name'] }}" to proceed:<br>
                                            THERE IS NO GOING BACK!
                                        </p>
                                        <input type="text" id="confirmInputWipe" placeholder="Type confirmation message"
                                            class="input mb-2">
                                        <input type="text" id="reasonInputWipe" placeholder="Reason for Wipe"
                                            class="input">
                                        <button id="confirmButtonWipe" class="button is-primary">Confirm</button>
                                        <button id="cancelButtonWipe" class="button cancel">Cancel</button>
                                    </div>
                                </div>
                                <style>
                                    .hidden {
                                        display: none !important;
                                    }

                                    .notification-content .input {
                                        max-width: 50% !important;
                                    }

                                    .notification-content .cancel {
                                        background-color: green !important;
                                        border: 0px solid transparent !important;
                                    }

                                    .notification-w {
                                        position: fixed;
                                        top: 0;
                                        left: 0;
                                        right: 0;
                                        bottom: 0;
                                        background: rgba(0, 0, 0, 0.5);
                                        display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        z-index: 11;
                                    }

                                    .notification-content {
                                        background: hsl(var(--main), 10.7%, 24.7%);
                                        border: 3px solid hsl(var(--main), 1.4%, 15.5%);
                                        color: #fff;
                                        padding: 20px;
                                        border-radius: 17px;
                                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                                        text-align: center;
                                    }
                                </style>
                                <!-- end confirm pop up -->
                            </div>
                        </div>
                        <div class="edit-divider"></div>
                        <div class="d-flex flex-column">
                            {% if not access_denied.higher_group and session.authenticated and session.user_data['id'] == 3 %}
                            <div class="input-fields-group">
                                <form action="{{ url_for('admin.update_userpw', id=user_data['id']) }}" method="POST">
                                    <div class="input-container">
                                        <div class="input-title">Password</div>
                                        <div class="field-body">
                                            <div class="field">
                                                <p class="control d-flex">
                                                    <input placeholder="Update user's password" class="input" type="text"
                                                        name="password" value="">
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="custom-button buttons mt-2">
                                            <button class="button is-primary" type="submit" onclick="example(event)">
                                                <span class="icon is-small"><i class="fas fa-check"></i></span>
                                                <span>Save</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            {% endif %}
                            <div class="input-fields-group mt-6">
                                <div class="input-container">
                                    <h3 class="">Privileges (0/2 done)</h3>
                                    <div class="input-title">User's privilege groups</div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control">
                                                <input placeholder="privileges list" class="input" type="text"
                                                    name="username" value="">
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-container">
                                    <div class="input-title">Add privileges</div>
                                    <div class="field-body">
                                        <div class="field">
                                            <p class="control">
                                                <select name="privileges" class="input">
                                                    <option value="">Select privilege</option>
                                                    <option value="Normal">Normal</option>
                                                    <option value="Verified">Verified</option>
                                                    <option value="Whitelisted">Whitelisted</option>
                                                    <option value="Supporter">Supporter</option>
                                                    <option value="Premium">Premium</option>
                                                    <option value="Alumni">Alumni</option>
                                                    <option value="Oguser">Oguser</option>
                                                    <option value="Tournament">Tournament</option>
                                                    <option value="Nominator">Nominator</option>
                                                    <option value="Mod">Moderator</option>
                                                    <option value="Admin">Admin</option>
                                                    <option value="Donator">Donator</option>
                                                    <option value="Staff">Staff</option>
                                                </select>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="custom-button buttons mt-6">
                                    <button class='button is-primary' type='submit'><span class='icon is-small'><i
                                                class='fas fa-check'></i></span><span>Save</span></button>
                                </div>
                            </div>
                        </div>
                        <div class="edit-divider"></div>
                        <div class="input-field-groups">
                            <h3 class="mb-4">Customisations preview</h3>
                            <div class="preview-block" id="avatar">
                                <div class="top-block"></div>
                                <div class="bottom-block">
                                    <div class="profile-avatar-area">
                                        <img id="avatar-img" src="https://a.{{ domain() }}/{{ user_data['id']}}"
                                            alt="avatar" class="rounded-avatar profile-avatar">
                                    </div>
                                </div>
                                <div class="bottom-block social-block">
                                    Social: <i class="fab fa-discord"></i> {{
                                    user_data['discord_content']
                                    }}, <i class="fas fa-suitcase"></i> {{ user_data['occupation_content'] }},
                                    <i class="fas fa-location-dot"></i> {{ user_data['location_content'] }},
                                    <i class="fas fa-heart"></i> {{ user_data['interest_content'] }}
                                </div>
                                <div class="profile-aboutme">
                                    <div class="about-box">
                                        <div class="about-titlebox">
                                            <div class="about-title">
                                                <i class="fas fa-address-card mr-2"></i>About me
                                            </div>
                                        </div>
                                        <div class="about-content">
                                            {{ user_data['userpage_content'] }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="user-info-card">
                    <h2 class="page-title">User logs</h2>
                </div>
                <div class="user-edit-card">
                    <div class="table-responsive">
                        {% if logs_data %}
                        <table class="table card-table table-vcenter text-nowrap datatable">
                            <thead>
                                <tr>
                                    <th>Log ID</th>
                                    <th>From/By</th>
                                    <th>To/Offender</th>
                                    <th>Action</th>
                                    <th>Details/Message</th>
                                    <th class="sortable" data-sort="time">Time <i class="fa fa-sort"></i></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for log_data in logs_data %}
                                <tr>
                                    <td>{{ log_data['id'] }}</td>
                                    <td><a href="/u/{{ log_data['from'] }}">{{ log_data['from_name'] }}</a></td>
                                    <td><a href="/u/{{ log_data['to'] }}">{{ log_data['to_name'] }}</a></td>
                                    <td>
                                        {% if log_data['action'] in ["0", "2", "5", "request", "restrict", "unrestrict",
                                        "wipe", "note"] %}
                                        {% if log_data['action'] == "0" %} updated a beatmap to graveyarded
                                        {% elif log_data['action'] == "2" %} updated a beatmap to ranked
                                        {% elif log_data['action'] == "5" %} updated a beatmap to loved
                                        {% elif log_data['action'] == "request" %} requested a beatmap to be ranked
                                        {% elif log_data['action'] == "restrict" %} account was restricted
                                        {% elif log_data['action'] == "unrestrict" %} account has been unbanned
                                        {% elif log_data['action'] == "wipe" %} wiped the user's profile
                                        {% elif log_data['action'] == "note" %} added a note
                                        {% endif %}
                                        {% else %}
                                        {{ log_data['action'] }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if log_data['action'] in ["0", "2", "5"] or log_data['action'] == "request"
                                        %}
                                        <a href="/b/{{ log_data['msg'] }}">{{ log_data['msg'] }}</a>
                                        {% else %}
                                        {{ log_data['msg'] }}
                                        {% endif %}
                                    </td>
                                    <td data-time="{{ log_data['time'] }}">{{ log_data['time'] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="card-pager">
                            <a class="pager-btn prev-btn"><i aria-hidden="true"
                                    class="fa-solid fa-chevron-left"></i></a>
                            <span class="pager-text"></span>
                            <a class="pager-btn next-btn"><i aria-hidden="true"
                                    class="fa-solid fa-chevron-right"></i></a>
                        </div>
                        {% else %}
                        <span>No logs found</span>
                        {% endif %}
                    </div>
                </div>
            </div>


            {% endif %}
        </div>
    </div>
</div>

<style>
    .preview-block {
        background: linear-gradient(hsl(var(--main), 25%, 25%, 20%), hsl(var(--main), 10%, 10%)),
        url("/backgrounds/{{ user_data['id'] }}");
        background-size: cover !important;
        background-position: center !important;
    }

    #avatar .top-block {
        width: 100%;
        height: 100px;
        background: url("/banners/{{ user_data['id'] }}");
        background-position: center;
        background-size: cover;
        border-top-left-radius: 9px;
        border-top-right-radius: 9px;
    }
</style>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

<script>
    $(document).ready(function () {
        var currentPage = 1; // Current page
        var logsPerPage = 10; // Number of logs per page
        var logs = $("tbody tr"); // All log rows
        var totalLogs = logs.length; // Total number of logs
        var totalPages = Math.ceil(totalLogs / logsPerPage); // Calculate total pages
        var sortOrder = 'asc'; // Default sort order

        updatePager(); // Initial update
        updateLogsTable(); // Show logs for the first page

        // Function to update pager text
        function updatePager() {
            $(".pager-text").text(currentPage + " / " + totalPages);
        }

        // Function to update logs table based on page
        function updateLogsTable() {
            var startIndex = (currentPage - 1) * logsPerPage;
            var endIndex = Math.min(startIndex + logsPerPage, totalLogs); // Ensure endIndex doesn't exceed log count

            // Hide all rows first
            logs.hide();

            // Show rows for current page
            for (var i = startIndex; i < endIndex; i++) {
                logs.eq(i).show();
            }
        }

        // Click event for previous button
        $(".prev-btn").click(function () {
            if (currentPage > 1) {
                currentPage--;
                updatePager();
                updateLogsTable();
            }
        });

        // Click event for next button
        $(".next-btn").click(function () {
            if (currentPage < totalPages) {
                currentPage++;
                updatePager();
                updateLogsTable();
            }
        });

        // Click event for sorting
        $(".sortable").click(function () {
            var sortKey = $(this).data('sort');
            sortOrder = (sortOrder === 'asc') ? 'desc' : 'asc';
            sortLogs(sortKey, sortOrder);
            updatePager();
            updateLogsTable();
            updateSortIcons();
        });

        // Function to sort logs
        function sortLogs(key, order) {
            logs.sort(function (a, b) {
                var aValue = $(a).find('td[data-' + key + ']').data(key);
                var bValue = $(b).find('td[data-' + key + ']').data(key);
                if (order === 'asc') {
                    return (aValue > bValue) ? 1 : (aValue < bValue) ? -1 : 0;
                } else {
                    return (aValue < bValue) ? 1 : (aValue > bValue) ? -1 : 0;
                }
            }).appendTo("tbody");
        }

        // Function to update sort icons
        function updateSortIcons() {
            $(".sortable i").removeClass("fa-sort-up fa-sort-down").addClass("fa-sort");
            var sortIcon = (sortOrder === 'asc') ? 'fa-sort-up' : 'fa-sort-down';
            $(".sortable[data-sort='time'] i").removeClass("fa-sort").addClass(sortIcon);
        }
    });
</script>

<!-- windows for dngr buttons -->
<script>
    function exampleDGR(event) {
        event.preventDefault(); // Prevent the form from submitting immediately
        document.getElementById('notification').classList.remove('hidden');
    }

    // Cancel button
    const cancelButton = document.getElementById('cancelButton');
    if (cancelButton) {
        cancelButton.addEventListener('click', function () {
            document.getElementById('notification').classList.add('hidden');
        });
    } else {
        console.error("Cancel Button for Clear Graphs not found");
    }

    // confirmation button
    const confirmButton = document.getElementById('confirmButton');
    if (confirmButton) {
        confirmButton.addEventListener('click', function () {
            const userInput = document.getElementById('confirmInput').value;
            const correctInput = `Confirm clearing graphs for {{ user_data['name'] }}`;
            console.log("Confirm button clicked for Clear Graphs");

            if (userInput === correctInput) {
                console.log("Clear graphs confirmed");
                document.getElementById('confirmationDialog').classList.add('hidden');
                document.getElementById('GraphForm').submit();
            } else {
                alert(`Incorrect input. Please type "${correctInput}" to proceed.`);
            }
        });
    } else {
        console.error("Confirm Button for Clear Graphs not found");
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log("Document loaded and ready");

        // Function to handle restriction
        function exampleRestrict(event) {
            event.preventDefault(); // Prevent the form from submitting immediately
            const restrictDialog = document.getElementById('confirmationDialogRestrict');
            if (restrictDialog) {
                console.log("Restrict button clicked");
                restrictDialog.classList.remove('hidden');
                console.log("Removed 'hidden' class from Restrict Dialog");
            } else {
                console.error("Restrict Dialog element not found");
            }
        }

        // Function to handle unrestriction
        function exampleUnrestrict(event) {
            event.preventDefault(); // Prevent the form from submitting immediately
            const unrestrictDialog = document.getElementById('confirmationDialogUnrestrict');
            if (unrestrictDialog) {
                console.log("Unrestrict button clicked");
                unrestrictDialog.classList.remove('hidden');
                console.log("Removed 'hidden' class from Unrestrict Dialog");
            } else {
                console.error("Unrestrict Dialog element not found");
            }
        }

        // Check if restrict button exists and attach event listener
        const restrictButton = document.getElementById('restrictButton');
        if (restrictButton) {
            restrictButton.addEventListener('click', exampleRestrict);
            console.log("Restrict button event listener attached");
        } else {
            console.error("Restrict Button element not found");
        }

        // Check if unrestrict button exists and attach event listener
        const unrestrictButton = document.getElementById('unrestrictButton');
        if (unrestrictButton) {
            unrestrictButton.addEventListener('click', exampleUnrestrict);
            console.log("Unrestrict button event listener attached");
        } else {
            console.error("Unrestrict Button element not found");
        }

        // Restrict confirmation button
        const confirmButtonRestrict = document.getElementById('confirmButtonRestrict');
        if (confirmButtonRestrict) {
            confirmButtonRestrict.addEventListener('click', function () {
                const userInput = document.getElementById('confirmInputRestrict').value;
                const reason = document.getElementById('reasonInputRestrict').value;
                const correctInput = `Confirm restriction for {{ user_data['name'] }}`;
                console.log("Confirm button clicked for restriction");

                if (userInput === correctInput) {
                    console.log("Restriction confirmed");
                    document.getElementById('confirmationDialogRestrict').classList.add('hidden');
                    document.getElementById('reasonRestrict').value = reason;
                    document.getElementById('restrictForm').submit();
                } else {
                    alert(`Incorrect input. Please type "${correctInput}" to proceed.`);
                }
            });
        } else {
            console.error("Confirm Button for Restrict not found");
        }

        // Unrestrict confirmation button
        const confirmButtonUnrestrict = document.getElementById('confirmButtonUnrestrict');
        if (confirmButtonUnrestrict) {
            confirmButtonUnrestrict.addEventListener('click', function () {
                const userInput = document.getElementById('confirmInputUnrestrict').value;
                const reason = document.getElementById('reasonInputUnrestrict').value;
                const correctInput = `Confirm unrestriction for {{ user_data['name'] }}`;
                console.log("Confirm button clicked for unrestriction");

                if (userInput === correctInput) {
                    console.log("Unrestriction confirmed");
                    document.getElementById('confirmationDialogUnrestrict').classList.add('hidden');
                    document.getElementById('reasonUnrestrict').value = reason;
                    document.getElementById('unrestrictForm').submit();
                } else {
                    alert(`Incorrect input. Please type "${correctInput}" to proceed.`);
                }
            });
        } else {
            console.error("Confirm Button for Unrestrict not found");
        }

        // Cancel unrestriction button
        const cancelButtonUnrestrict = document.getElementById('cancelButtonUnrestrict');
        if (cancelButtonUnrestrict) {
            cancelButtonUnrestrict.addEventListener('click', function () {
                document.getElementById('confirmationDialogUnrestrict').classList.add('hidden');
            });
        } else {
            console.error("Cancel Button for Unrestrict not found");
        }

        // Cancel restriction button
        const cancelButtonRestrict = document.getElementById('cancelButtonRestrict');
        if (cancelButtonRestrict) {
            cancelButtonRestrict.addEventListener('click', function () {
                document.getElementById('confirmationDialogRestrict').classList.add('hidden');
            });
        } else {
            console.error("Cancel Button for Restrict not found");
        }

        console.log("Event listeners attached");
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log("Document loaded and ready");

        // Function to handle wipe
        function exampleWipe(event) {
            event.preventDefault(); // Prevent the form from submitting immediately
            const WipeDialog = document.getElementById('confirmationDialogWipe');
            if (WipeDialog) {
                console.log("Wipe button clicked");
                WipeDialog.classList.remove('hidden');
                console.log("Removed 'hidden' class from Wipe Dialog");
            } else {
                console.error("Wipe Dialog element not found");
            }
        }

        // Check if wipe button exists and attach event listener
        const WipeButton = document.getElementById('WipeButton');
        if (WipeButton) {
            WipeButton.addEventListener('click', exampleWipe);
            console.log("Wipe button event listener attached");
        } else {
            console.error("Wipe Button element not found");
        }

        // Wipe confirmation button
        const confirmButtonWipe = document.getElementById('confirmButtonWipe');
        if (confirmButtonWipe) {
            confirmButtonWipe.addEventListener('click', function () {
                const userInput = document.getElementById('confirmInputWipe').value;
                const reason = document.getElementById('reasonInputWipe').value;
                const correctInput = `Confirm wipe for {{ user_data['name'] }}`;
                console.log("Confirm button clicked for wipe");

                if (userInput === correctInput) {
                    console.log("Wipe confirmed");
                    document.getElementById('confirmationDialogWipe').classList.add('hidden');
                    document.getElementById('reasonWipe').value = reason;
                    document.getElementById('WipeForm').submit();
                } else {
                    alert(`Incorrect input. Please type "${correctInput}" to proceed.`);
                }
            });
        } else {
            console.error("Confirm Button for Wipe not found");
        }

        // Cancel restriction button
        const cancelButtonWipe = document.getElementById('cancelButtonWipe');
        if (cancelButtonWipe) {
            cancelButtonWipe.addEventListener('click', function () {
                document.getElementById('confirmationDialogWipe').classList.add('hidden');
            });
        } else {
            console.error("Cancel Button for Wipe not found");
        }

        console.log("Event listeners attached");
    });
</script>

<script>
    function example(event) {
        // Show the confirmation dialog
        const userConfirmed = confirm("Are you sure? This cannot be undone!");

        // If the user clicked "No" (userConfirmed is false), prevent the form submission
        if (!userConfirmed) {
            event.preventDefault();
        }
    }
</script>

<script src="/static/js/asserts/vue-flags.js"></script>

{% endblock %}